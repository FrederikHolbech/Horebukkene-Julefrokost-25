<!doctype html>
<html lang="da">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HOREBUKKENE - Julefrokost</title>
  <style>
    :root {
      --bg: #0b0d12;
      --card: rgba(255, 255, 255, .06);
      --text: rgba(255, 255, 255, .92);
      --muted: rgba(255, 255, 255, .65);
      --border: rgba(255, 255, 255, .12);
      --accent: #7c5cff;
      --ok: #24d18f;
      --bad: #ff5c7a;
      --shadow: 0 20px 60px rgba(0, 0, 0, .35);
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(800px 400px at 20% 0%, rgba(124, 92, 255, .25), transparent 60%),
        radial-gradient(800px 400px at 80% 10%, rgba(0, 255, 209, .12), transparent 60%),
        var(--bg);
      min-height: 100vh;
      padding: 24px;
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
    }

    .brand {
      font-size: 48px;
      line-height: 1.0;
      letter-spacing: -0.03em;
      margin: 0 0 24px 0;
      text-transform: uppercase;
      text-align: center;
    }

    /* Scoreboard Section */
    .scoreboard-section {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 24px;
      backdrop-filter: blur(12px);
      margin-bottom: 24px;
    }

    .scoreboard-title {
      font-size: 24px;
      font-weight: 600;
      margin: 0 0 16px 0;
      text-align: center;
    }

    .scoreboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .team {
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, .04);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all .2s;
    }

    .team:hover {
      background: rgba(255, 255, 255, .06);
      border-color: rgba(124, 92, 255, .3);
    }

    .team-name {
      font-size: 20px;
      font-weight: 600;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 8px;
      transition: background .2s;
    }

    .team-name:hover {
      background: rgba(255, 255, 255, .08);
    }

    .team-score {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .score-display {
      font-size: 32px;
      font-weight: 700;
      color: var(--accent);
      min-width: 60px;
      text-align: center;
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
      transition: background .2s;
    }

    .score-display:hover {
      background: rgba(124, 92, 255, .15);
    }

    .score-btn {
      width: 36px;
      height: 36px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .2);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .2s;
    }

    .score-btn:hover {
      background: rgba(124, 92, 255, .3);
      border-color: var(--accent);
    }

    .score-btn:active {
      transform: scale(0.95);
    }

    .scoreboard-controls {
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    /* Task Section */
    .task-section {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 32px;
      backdrop-filter: blur(12px);
    }

    .task-header {
      margin-bottom: 24px;
    }

    .task-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 16px;
    }

    .pill {
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .12);
      padding: 6px 12px;
      border-radius: 999px;
    }

    .task-title {
      font-size: 28px;
      font-weight: 600;
      margin: 0 0 12px 0;
    }

    .task-description {
      font-size: 16px;
      color: var(--muted);
      line-height: 1.5;
    }

    .task-content {
      margin: 24px 0;
    }

    /* Alphabet Task */
    .alphabet-input {
      width: 100%;
      border: 2px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 16px;
      border-radius: 14px;
      font-size: 24px;
      text-align: center;
      letter-spacing: 2px;
      outline: none;
      backdrop-filter: blur(10px);
      font-family: monospace;
      margin-bottom: 16px;
    }

    .alphabet-input:focus {
      border-color: var(--accent);
    }

    .alphabet-input.success {
      border-color: var(--ok);
    }

    .alphabet-input.error {
      border-color: var(--bad);
    }

    .timer {
      font-size: 48px;
      font-weight: 700;
      text-align: center;
      margin: 20px 0;
      color: var(--accent);
    }

    .timer.warning {
      color: var(--bad);
      animation: pulse 0.5s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.6;
      }
    }

    .feedback {
      text-align: center;
      font-size: 18px;
      margin: 16px 0;
      min-height: 30px;
    }

    .feedback.ok {
      color: var(--ok);
    }

    .feedback.bad {
      color: var(--bad);
    }

    .btn {
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .12);
      color: var(--text);
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      transition: all .2s;
      font-weight: 500;
    }

    .btn:hover {
      background: rgba(124, 92, 255, .2);
      border-color: rgba(124, 92, 255, .4);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn.primary {
      background: rgba(124, 92, 255, .3);
      border-color: rgba(124, 92, 255, .5);
    }

    .task-nav {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-top: 24px;
    }

    /* Modal for PIN */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, .7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(180deg, rgba(255, 255, 255, .12), rgba(255, 255, 255, .06));
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 32px;
      max-width: 400px;
      width: 90%;
      box-shadow: var(--shadow);
    }

    .modal h2 {
      margin: 0 0 16px 0;
      font-size: 24px;
    }

    .modal input {
      width: 100%;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 12px;
      border-radius: 12px;
      font-size: 18px;
      text-align: center;
      letter-spacing: 4px;
      margin-bottom: 16px;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
    }

    .modal-buttons .btn {
      flex: 1;
    }

    .error-msg {
      color: var(--bad);
      font-size: 14px;
      margin-top: -8px;
      margin-bottom: 12px;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1 class="brand">üéÑ HOREBUKKENE üéÑ</h1>

    <!-- Scoreboard -->
    <div class="scoreboard-section">
      <h2 class="scoreboard-title">Scoreboard</h2>
      <div class="scoreboard" id="scoreboard"></div>
      <div class="scoreboard-controls">
        <button class="btn" onclick="resetScores()">Nulstil Point</button>
      </div>
    </div>

    <!-- Task Area -->
    <div class="task-section">
      <div class="task-header">
        <div class="task-meta">
          <span class="pill" id="taskCounter">Opgave 1/5</span>
          <span class="pill" id="taskStatus">Ikke startet</span>
        </div>
        <h2 class="task-title" id="taskTitle">Alfabetet Challenge</h2>
        <p class="task-description" id="taskDescription">Skriv alfabetet a-z s√• hurtigt som muligt. Du skal g√∏re det p√•
          under 10 sekunder!</p>
      </div>

      <div class="task-content" id="taskContent">
        <!-- Task content will be inserted here -->
      </div>

      <div class="task-nav">
        <button class="btn" id="prevTaskBtn" onclick="previousTask()" disabled>‚Üê Forrige</button>
        <button class="btn primary" id="nextTaskBtn" onclick="nextTask()" disabled>N√¶ste ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- PIN Modal -->
  <div class="modal" id="pinModal">
    <div class="modal-content">
      <h2 id="modalTitle">Indtast PIN</h2>
      <input type="password" id="pinInput" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <div class="error-msg" id="errorMsg"></div>
      <div class="modal-buttons">
        <button class="btn" onclick="closeModal()">Annuller</button>
        <button class="btn" id="pinOkBtn">OK</button>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h2 id="editModalTitle">Rediger</h2>
      <input type="text" id="editInput" placeholder="" />
      <div class="modal-buttons">
        <button class="btn" onclick="closeEditModal()">Annuller</button>
        <button class="btn" id="editOkBtn" onclick="saveEdit()">Gem</button>
      </div>
    </div>
  </div>

  <script>
    const PIN = "0910";
    let teams = [
      { name: "Hold 1", score: 0 },
      { name: "Hold 2", score: 0 },
      { name: "Hold 3", score: 0 },
      { name: "Hold 4", score: 0 }
    ];

    let currentAction = null;
    let currentTeamIndex = null;
    let editType = null;

    // Task system
    let currentTaskIndex = 0;
    const tasks = [
      {
        title: "Alfabetet Challenge",
        description: "Skriv alfabetet a-z s√• hurtigt som muligt. Du skal g√∏re det p√• under 10 sekunder!",
        type: "alphabet",
        timeLimit: 10
      },
      {
        title: "Opgave 2",
        description: "Kommende opgave...",
        type: "placeholder"
      },
      {
        title: "Opgave 3",
        description: "Kommende opgave...",
        type: "placeholder"
      },
      {
        title: "Opgave 4",
        description: "Kommende opgave...",
        type: "placeholder"
      },
      {
        title: "Opgave 5",
        description: "Kommende opgave...",
        type: "placeholder"
      }
    ];

    // Alphabet task state
    let alphabetTimer = null;
    let alphabetStartTime = null;
    let alphabetElapsed = 0;
    let alphabetCompleted = false;

    // ===== SCOREBOARD FUNCTIONS =====

    function loadData() {
      const saved = localStorage.getItem("scoreboardData");
      if (saved) {
        try {
          teams = JSON.parse(saved);
        } catch (e) {
          console.error("Kunne ikke indl√¶se data");
        }
      }
    }

    function saveData() {
      localStorage.setItem("scoreboardData", JSON.stringify(teams));
    }

    function renderScoreboard() {
      const sb = document.getElementById("scoreboard");
      sb.innerHTML = "";

      teams.forEach((team, idx) => {
        const teamDiv = document.createElement("div");
        teamDiv.className = "team";
        teamDiv.innerHTML = `
          <div class="team-name" onclick="editTeamName(${idx})">${team.name}</div>
          <div class="team-score">
            <button class="score-btn" onclick="changeScore(${idx}, -1)">‚àí</button>
            <div class="score-display" onclick="editScore(${idx})">${team.score}</div>
            <button class="score-btn" onclick="changeScore(${idx}, 1)">+</button>
          </div>
        `;
        sb.appendChild(teamDiv);
      });
    }

    function changeScore(idx, delta) {
      currentTeamIndex = idx;
      editType = 'scoreChange';
      // Store the delta for later use
      changeScore.delta = delta;
      showPinModal(delta > 0 ? "Indtast PIN for at tilf√∏je point" : "Indtast PIN for at fjerne point");
    }

    function editScore(idx) {
      console.log('editScore called for team:', idx);
      currentTeamIndex = idx;
      editType = 'score';
      showPinModal("Indtast PIN for at √¶ndre point");
    }

    function editTeamName(idx) {
      console.log('editTeamName called for team:', idx);
      currentTeamIndex = idx;
      editType = 'name';
      showPinModal("Indtast PIN for at √¶ndre holdnavn");
    }

    function resetScores() {
      currentAction = () => {
        if (confirm("Er du sikker p√• at du vil nulstille alle point?")) {
          teams.forEach(t => t.score = 0);
          saveData();
          renderScoreboard();
        }
      };
      currentTeamIndex = null;
      showPinModal("Indtast PIN for at nulstille");
    }

    function showPinModal(title) {
      document.getElementById("modalTitle").textContent = title;
      document.getElementById("pinInput").value = "";
      document.getElementById("errorMsg").textContent = "";
      document.getElementById("pinModal").classList.add("show");
      document.getElementById("pinInput").focus();
    }

    function closeModal() {
      document.getElementById("pinModal").classList.remove("show");
      currentAction = null;
      currentTeamIndex = null;
      editType = null;
    }

    function showEditModal(title, currentValue, type) {
      console.log('showEditModal called:', title, currentValue, type);
      console.log('currentTeamIndex before showEditModal:', currentTeamIndex);

      // Store both editType and currentTeamIndex - they were set before calling this
      // Don't let them get overwritten
      const teamIndex = currentTeamIndex;

      editType = type;
      currentTeamIndex = teamIndex;

      console.log('After setting - editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      const editModal = document.getElementById("editModal");
      const editInput = document.getElementById("editInput");

      document.getElementById("editModalTitle").textContent = title;
      editInput.value = currentValue;

      if (type === 'score') {
        editInput.type = 'number';
        editInput.min = '0';
      } else {
        editInput.type = 'text';
      }

      editModal.classList.add("show");
      console.log('Edit modal visible, editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      setTimeout(() => {
        editInput.focus();
        editInput.select();
      }, 50);
    }

    function closeEditModal() {
      document.getElementById("editModal").classList.remove("show");
      currentTeamIndex = null;
      editType = null;
    }

    function saveEdit() {
      console.log('saveEdit called, editType:', editType, 'currentTeamIndex:', currentTeamIndex);
      const value = document.getElementById("editInput").value;
      console.log('Input value:', value);

      if (editType === 'name' && value.trim()) {
        console.log('Saving team name');
        teams[currentTeamIndex].name = value.trim();
        saveData();
        renderScoreboard();
        closeEditModal();
      } else if (editType === 'score') {
        const num = parseInt(value);
        console.log('Parsed score:', num);
        if (!isNaN(num) && num >= 0) {
          console.log('Saving team score');
          teams[currentTeamIndex].score = num;
          saveData();
          renderScoreboard();
          closeEditModal();
        }
      } else if (editType === 'scoreChange') {
        const amount = parseInt(value);
        console.log('Parsed score change amount:', amount);
        if (!isNaN(amount) && amount > 0) {
          const delta = changeScore.delta;
          console.log('Delta:', delta, 'applying change');
          if (delta > 0) {
            teams[currentTeamIndex].score += amount;
          } else {
            teams[currentTeamIndex].score = Math.max(0, teams[currentTeamIndex].score - amount);
          }
          saveData();
          renderScoreboard();
          closeEditModal();
        }
      } else {
        console.log('No valid save condition met');
      }
    }

    function verifyPin() {
      const input = document.getElementById("pinInput").value;

      // Check if already processing
      if (verifyPin.isProcessing) {
        console.log('Already processing, ignoring duplicate call');
        return;
      }

      console.log('Verifying PIN, editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      if (input === PIN) {
        verifyPin.isProcessing = true;

        // Save editType and currentTeamIndex before closing modal
        const savedEditType = editType;
        const savedTeamIndex = currentTeamIndex;
        const savedAction = currentAction;

        console.log('Saved values - editType:', savedEditType, 'teamIndex:', savedTeamIndex, 'hasAction:', !!savedAction);

        closeModal();

        // Use setTimeout to ensure modal closes before opening edit modal
        setTimeout(() => {
          console.log('Inside setTimeout - editType:', savedEditType, 'teamIndex:', savedTeamIndex);
          if (savedAction) {
            console.log('Executing currentAction');
            savedAction();
          }
          else if (savedEditType === 'name') {
            console.log('Opening name edit modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            showEditModal(`Rediger ${teams[savedTeamIndex].name}`, teams[savedTeamIndex].name, savedEditType);
          } else if (savedEditType === 'score') {
            console.log('Opening score edit modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            showEditModal(`Rediger point for ${teams[savedTeamIndex].name}`, teams[savedTeamIndex].score, savedEditType);
          } else if (savedEditType === 'scoreChange') {
            console.log('Opening score change modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            const delta = changeScore.delta;
            const action = delta > 0 ? 'Tilf√∏j' : 'Fjern';
            showEditModal(`${action} point for ${teams[savedTeamIndex].name}`, Math.abs(delta), savedEditType);
          } else {
            console.log('No matching condition - savedEditType:', savedEditType, 'savedAction:', savedAction);
          }

          verifyPin.isProcessing = false;
        }, 150);
      } else {
        document.getElementById("errorMsg").textContent = "Forkert PIN - pr√∏v igen";
        document.getElementById("pinInput").value = "";
        document.getElementById("pinInput").focus();
      }
    }    // ===== TASK FUNCTIONS =====

    function renderTask() {
      const task = tasks[currentTaskIndex];
      document.getElementById("taskCounter").textContent = `Opgave ${currentTaskIndex + 1}/${tasks.length}`;
      document.getElementById("taskTitle").textContent = task.title;
      document.getElementById("taskDescription").textContent = task.description;

      const content = document.getElementById("taskContent");

      if (task.type === "alphabet") {
        renderAlphabetTask(content);
      } else {
        content.innerHTML = `
          <div style="text-align: center; padding: 40px; color: var(--muted);">
            <p style="font-size: 20px;">Denne opgave er endnu ikke tilg√¶ngelig</p>
          </div>
        `;
        document.getElementById("taskStatus").textContent = "Ikke tilg√¶ngelig";
      }

      // Update navigation buttons
      document.getElementById("prevTaskBtn").disabled = currentTaskIndex === 0;
      document.getElementById("nextTaskBtn").disabled = currentTaskIndex === tasks.length - 1;
    }

    function nextTask() {
      if (currentTaskIndex < tasks.length - 1) {
        currentTaskIndex++;
        renderTask();
      }
    }

    function previousTask() {
      if (currentTaskIndex > 0) {
        currentTaskIndex--;
        renderTask();
      }
    }

    // ===== ALPHABET TASK =====

    function renderAlphabetTask(container) {
      container.innerHTML = `
        <div class="timer" id="alphabetTimer">0.00s</div>
        <input 
          type="text" 
          class="alphabet-input" 
          id="alphabetInput" 
          placeholder="Tryk for at starte - skriv alfabetet a-z..."
          autocomplete="off"
          spellcheck="false"
        />
        <div class="feedback" id="alphabetFeedback"></div>
        <div style="text-align: center;">
          <button class="btn" onclick="resetAlphabetTask()">Pr√∏v igen</button>
        </div>
      `;

      const input = document.getElementById("alphabetInput");
      input.addEventListener("input", handleAlphabetInput);
      input.addEventListener("focus", startAlphabetTimer);

      alphabetCompleted = false;
      document.getElementById("taskStatus").textContent = "Klar til start";
    }

    function startAlphabetTimer() {
      if (alphabetTimer || alphabetCompleted) return;

      alphabetStartTime = Date.now();
      document.getElementById("taskStatus").textContent = "I gang!";

      alphabetTimer = setInterval(() => {
        alphabetElapsed = (Date.now() - alphabetStartTime) / 1000;
        const timerEl = document.getElementById("alphabetTimer");
        timerEl.textContent = alphabetElapsed.toFixed(2) + "s";

        if (alphabetElapsed > tasks[currentTaskIndex].timeLimit) {
          timerEl.classList.add("warning");
        }
      }, 10);
    }

    function handleAlphabetInput(e) {
      if (alphabetCompleted) return;

      const input = e.target;
      const value = input.value.toLowerCase().replace(/[^a-z]/g, '');
      input.value = value;

      const expected = "abcdefghijklmnopqrstuvwxyz";
      const feedback = document.getElementById("alphabetFeedback");

      // Check if correct so far
      if (value === expected.substring(0, value.length)) {
        input.classList.remove("error");
        input.classList.add("success");

        // Check if complete
        if (value === expected) {
          completeAlphabetTask(true);
        }
      } else {
        input.classList.add("error");
        input.classList.remove("success");
        feedback.className = "feedback bad";
        feedback.textContent = "Forkert bogstav! Pr√∏v igen.";
      }
    }

    function completeAlphabetTask(success) {
      if (alphabetCompleted) return;
      alphabetCompleted = true;

      clearInterval(alphabetTimer);
      alphabetTimer = null;

      const feedback = document.getElementById("alphabetFeedback");
      const input = document.getElementById("alphabetInput");
      const timeLimit = tasks[currentTaskIndex].timeLimit;

      input.disabled = true;

      if (success && alphabetElapsed <= timeLimit) {
        feedback.className = "feedback ok";
        feedback.textContent = `üéâ Tillykke! Du klarede det p√• ${alphabetElapsed.toFixed(2)} sekunder!`;
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        document.getElementById("nextTaskBtn").disabled = false;
      } else if (success) {
        feedback.className = "feedback bad";
        feedback.textContent = `‚è∞ Du brugte ${alphabetElapsed.toFixed(2)} sekunder - for langsomt! Pr√∏v igen.`;
        document.getElementById("taskStatus").textContent = "For langsom";
      }
    }

    function resetAlphabetTask() {
      clearInterval(alphabetTimer);
      alphabetTimer = null;
      alphabetStartTime = null;
      alphabetElapsed = 0;
      alphabetCompleted = false;

      const input = document.getElementById("alphabetInput");
      const timer = document.getElementById("alphabetTimer");
      const feedback = document.getElementById("alphabetFeedback");

      input.value = "";
      input.disabled = false;
      input.classList.remove("success", "error");
      timer.textContent = "0.00s";
      timer.classList.remove("warning");
      feedback.textContent = "";
      feedback.className = "feedback";
      document.getElementById("taskStatus").textContent = "Klar til start";
    }

    // ===== EVENT LISTENERS =====

    document.getElementById("pinOkBtn").addEventListener("click", verifyPin);

    document.getElementById("pinInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        verifyPin();
      }
    });

    document.getElementById("editOkBtn").addEventListener("click", saveEdit);

    document.getElementById("editInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        saveEdit();
      }
    });

    // ===== INITIALIZE =====
    loadData();
    renderScoreboard();
    renderTask();
  </script>
</body>

</html>