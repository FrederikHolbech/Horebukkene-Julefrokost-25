<!doctype html>
<html lang="da">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HOREBUKKENE - Julefrokost</title>
  <style>
    :root {
      --bg: #0b0d12;
      --card: rgba(255, 255, 255, .06);
      --text: rgba(255, 255, 255, .92);
      --muted: rgba(255, 255, 255, .65);
      --border: rgba(255, 255, 255, .12);
      --accent: #7c5cff;
      --ok: #24d18f;
      --bad: #ff5c7a;
      --shadow: 0 20px 60px rgba(0, 0, 0, .35);
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(800px 400px at 20% 0%, rgba(124, 92, 255, .25), transparent 60%),
        radial-gradient(800px 400px at 80% 10%, rgba(0, 255, 209, .12), transparent 60%),
        var(--bg);
      min-height: 100vh;
      padding: 24px;
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
    }

    .brand {
      font-size: 48px;
      line-height: 1.0;
      letter-spacing: -0.03em;
      margin: 0 0 24px 0;
      text-transform: uppercase;
      text-align: center;
    }

    /* Scoreboard Section */
    .scoreboard-section {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 24px;
      backdrop-filter: blur(12px);
      margin-bottom: 24px;
    }

    .scoreboard-title {
      font-size: 24px;
      font-weight: 600;
      margin: 0 0 16px 0;
      text-align: center;
    }

    .scoreboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .team {
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, .04);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all .2s;
    }

    .team:hover {
      background: rgba(255, 255, 255, .06);
      border-color: rgba(124, 92, 255, .3);
    }

    .team-name {
      font-size: 20px;
      font-weight: 600;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 8px;
      transition: background .2s;
    }

    .team-name:hover {
      background: rgba(255, 255, 255, .08);
    }

    .team-score {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .score-display {
      font-size: 32px;
      font-weight: 700;
      color: var(--accent);
      min-width: 60px;
      text-align: center;
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
      transition: background .2s;
    }

    .score-display:hover {
      background: rgba(124, 92, 255, .15);
    }

    .score-btn {
      width: 36px;
      height: 36px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .2);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .2s;
    }

    .score-btn:hover {
      background: rgba(124, 92, 255, .3);
      border-color: var(--accent);
    }

    .score-btn:active {
      transform: scale(0.95);
    }

    .scoreboard-controls {
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    /* Task Grid */
    .task-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .task-card {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-radius: 14px;
      padding: 24px;
      cursor: pointer;
      transition: all .2s;
      backdrop-filter: blur(12px);
    }

    .task-card:hover {
      background: linear-gradient(180deg, rgba(124, 92, 255, .15), rgba(124, 92, 255, .08));
      border-color: rgba(124, 92, 255, .4);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .task-card-number {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .task-card-title {
      font-size: 22px;
      font-weight: 600;
      margin: 0 0 12px 0;
    }

    .task-card-description {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
    }

    /* Task Detail View */
    .task-detail {
      display: none;
    }

    .task-detail.active {
      display: block;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .12);
      color: var(--text);
      padding: 10px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 15px;
      transition: all .2s;
      margin-bottom: 24px;
    }

    .back-btn:hover {
      background: rgba(124, 92, 255, .2);
      border-color: rgba(124, 92, 255, .4);
    }

    /* Task Section */
    .task-section {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 32px;
      backdrop-filter: blur(12px);
    }

    .tasks-overview {
      display: block;
    }

    .tasks-overview.hidden {
      display: none;
    }

    .task-header {
      margin-bottom: 24px;
    }

    .task-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 16px;
    }

    .pill {
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .12);
      padding: 6px 12px;
      border-radius: 999px;
    }

    .task-title {
      font-size: 28px;
      font-weight: 600;
      margin: 0 0 12px 0;
    }

    .task-description {
      font-size: 16px;
      color: var(--muted);
      line-height: 1.5;
    }

    .task-content {
      margin: 24px 0;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.6;
      }
    }

    .feedback {
      text-align: center;
      font-size: 18px;
      margin: 16px 0;
      min-height: 30px;
    }

    .feedback.ok {
      color: var(--ok);
    }

    .feedback.bad {
      color: var(--bad);
    }

    .btn {
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .12);
      color: var(--text);
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      transition: all .2s;
      font-weight: 500;
    }

    .btn:hover {
      background: rgba(124, 92, 255, .2);
      border-color: rgba(124, 92, 255, .4);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn.primary {
      background: rgba(124, 92, 255, .3);
      border-color: rgba(124, 92, 255, .5);
    }

    .task-nav {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-top: 24px;
    }

    /* Modal for PIN */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, .7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(180deg, rgba(255, 255, 255, .12), rgba(255, 255, 255, .06));
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 32px;
      max-width: 400px;
      width: 90%;
      box-shadow: var(--shadow);
    }

    .modal h2 {
      margin: 0 0 16px 0;
      font-size: 24px;
    }

    .modal input {
      width: 100%;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 12px;
      border-radius: 12px;
      font-size: 18px;
      text-align: center;
      letter-spacing: 4px;
      margin-bottom: 16px;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
    }

    .modal-buttons .btn {
      flex: 1;
    }

    .error-msg {
      color: var(--bad);
      font-size: 14px;
      margin-top: -8px;
      margin-bottom: 12px;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1 class="brand">üéÑ HOREBUKKENE üéÑ</h1>

    <!-- Scoreboard -->
    <div class="scoreboard-section">
      <h2 class="scoreboard-title">Scoreboard</h2>
      <div class="scoreboard" id="scoreboard"></div>
      <div class="scoreboard-controls">
        <button class="btn" onclick="resetScores()">Nulstil Point</button>
        <button class="btn" onclick="resetTasks()">Nulstil Opgaver</button>
      </div>
    </div>

    <!-- Task Area -->
    <div class="task-section">
      <!-- Overview of all tasks -->
      <div id="tasksOverview" class="tasks-overview">
        <h2 style="font-size: 32px; font-weight: 600; margin: 0 0 24px 0;">Opgaver</h2>
        <div class="task-grid" id="taskGrid"></div>
      </div>

      <!-- Individual task detail view -->
      <div id="taskDetail" class="task-detail">
        <button class="back-btn" onclick="showTasksOverview()">‚Üê Tilbage til opgaver</button>

        <div class="task-header">
          <div class="task-meta">
            <span class="pill" id="taskCounter">Opgave 1/5</span>
            <span class="pill" id="taskStatus">Ikke startet</span>
          </div>
          <h2 class="task-title" id="taskTitle">Alfabetet Challenge</h2>
          <p class="task-description" id="taskDescription">Skriv alfabetet a-z s√• hurtigt som muligt. Du skal g√∏re det
            p√•
            under 10 sekunder!</p>
        </div>

        <div class="task-content" id="taskContent">
          <!-- Task content will be inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- PIN Modal -->
  <div class="modal" id="pinModal">
    <div class="modal-content">
      <h2 id="modalTitle">Indtast PIN</h2>
      <input type="password" id="pinInput" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <div class="error-msg" id="errorMsg"></div>
      <div class="modal-buttons">
        <button class="btn" onclick="closeModal()">Annuller</button>
        <button class="btn" id="pinOkBtn">OK</button>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h2 id="editModalTitle">Rediger</h2>
      <input type="text" id="editInput" placeholder="" />
      <div class="modal-buttons">
        <button class="btn" onclick="closeEditModal()">Annuller</button>
        <button class="btn" id="editOkBtn" onclick="saveEdit()">Gem</button>
      </div>
    </div>
  </div>

  <script>
    const PIN = "1202";
    let teams = [
      { name: "Hold 1", score: 0 },
      { name: "Hold 2", score: 0 },
      { name: "Hold 3", score: 0 },
      { name: "Hold 4", score: 0 }
    ];

    let currentAction = null;
    let currentTeamIndex = null;
    let editType = null;

    // Task system
    let currentTaskIndex = 0;
    let completedTasks = [];
    const tasks = [
      {
        title: "Find Sangen - 10 Point",
        description: "G√¶t sangen ud fra emoji! üéµ",
        type: "emoji-songs"
      },
      {
        title: "Klik Udfordring - 10 Point",
        description: "Tryk p√• knappen 75+ gange p√• 10 sekunder! üñ±Ô∏è",
        type: "click-challenge"
      },
      {
        title: "Beer Pong Challenge - 15 Point",
        description: "Kast bolden i kopperne 4 gange i streg! üç∫",
        type: "beer-pong"
      },
      {
        title: "Fysiologi Quiz - 10 Point",
        description: "Svar p√• 5 sp√∏rgsm√•l om fysiologi! üß†",
        type: "physiology-quiz"
      },
      {
        title: "Snyd V√¶rten - 5 Point",
        description: "Drik vand eller sambuca - kan Dunkin g√¶tte det? ü•É",
        type: "trick-host"
      },
      {
        title: "Suger√∏rs Challenge - 5 Point",
        description: "Drik en √∏l gennem et suger√∏r! üç∫ü•§",
        type: "straw-challenge"
      },
      {
        title: "√òlbong Challenge - 10 Point",
        description: "Tag en √∏lbong p√• under 2,5 sekund! üç∫‚ö°",
        type: "beerbong-challenge"
      },
      {
        title: "Strava L√∏b - 10 Point",
        description: "L√∏b en kilometer og vis Dunkin bevis fra Strava! üèÉ‚Äç‚ôÇÔ∏è",
        type: "strava-run"
      },
      {
        title: "Yatzy Challenge - 50 Point",
        description: "Sl√• yatzy med 5 terninger! üé≤",
        type: "yatzy-challenge"
      }
    ];

    // ===== SCOREBOARD FUNCTIONS =====

    function loadData() {
      const saved = localStorage.getItem("scoreboardData");
      if (saved) {
        try {
          teams = JSON.parse(saved);
        } catch (e) {
          console.error("Kunne ikke indl√¶se data");
        }
      }
      const savedTasks = localStorage.getItem("completedTasks");
      if (savedTasks) {
        try {
          completedTasks = JSON.parse(savedTasks);
        } catch (e) {
          console.error("Kunne ikke indl√¶se opgaver");
        }
      }
    }

    function saveData() {
      localStorage.setItem("scoreboardData", JSON.stringify(teams));
      localStorage.setItem("completedTasks", JSON.stringify(completedTasks));
    }

    function renderScoreboard() {
      const sb = document.getElementById("scoreboard");
      sb.innerHTML = "";

      teams.forEach((team, idx) => {
        const teamDiv = document.createElement("div");
        teamDiv.className = "team";
        teamDiv.innerHTML = `
          <div class="team-name" onclick="editTeamName(${idx})">${team.name}</div>
          <div class="team-score">
            <button class="score-btn" onclick="changeScore(${idx}, -1)">‚àí</button>
            <div class="score-display" onclick="editScore(${idx})">${team.score}</div>
            <button class="score-btn" onclick="changeScore(${idx}, 1)">+</button>
          </div>
        `;
        sb.appendChild(teamDiv);
      });
    }

    function changeScore(idx, delta) {
      currentTeamIndex = idx;
      editType = 'scoreChange';
      // Store the delta for later use
      changeScore.delta = delta;
      showPinModal(delta > 0 ? "Indtast PIN for at tilf√∏je point" : "Indtast PIN for at fjerne point");
    }

    function editScore(idx) {
      console.log('editScore called for team:', idx);
      currentTeamIndex = idx;
      editType = 'score';
      showPinModal("Indtast PIN for at √¶ndre point");
    }

    function editTeamName(idx) {
      console.log('editTeamName called for team:', idx);
      currentTeamIndex = idx;
      editType = 'name';
      showPinModal("Indtast PIN for at √¶ndre holdnavn");
    }

    function resetScores() {
      currentAction = () => {
        if (confirm("Er du sikker p√• at du vil nulstille alle point?")) {
          teams.forEach(t => t.score = 0);
          saveData();
          renderScoreboard();
        }
      };
      currentTeamIndex = null;
      showPinModal("Indtast PIN for at nulstille");
    }

    function resetTasks() {
      currentAction = () => {
        if (confirm("Er du sikker p√• at du vil nulstille alle opgaver?")) {
          completedTasks = [];
          saveData();
          renderTaskGrid();
          showTasksOverview();
        }
      };
      currentTeamIndex = null;
      showPinModal("Indtast PIN for at nulstille opgaver");
    }

    function showPinModal(title) {
      document.getElementById("modalTitle").textContent = title;
      document.getElementById("pinInput").value = "";
      document.getElementById("errorMsg").textContent = "";
      document.getElementById("pinModal").classList.add("show");
      document.getElementById("pinInput").focus();
    }

    function closeModal() {
      document.getElementById("pinModal").classList.remove("show");
      currentAction = null;
      currentTeamIndex = null;
      editType = null;
    }

    function showEditModal(title, currentValue, type) {
      console.log('showEditModal called:', title, currentValue, type);
      console.log('currentTeamIndex before showEditModal:', currentTeamIndex);

      // DON'T reassign - currentTeamIndex and editType are already set before calling this
      // Just use them as-is

      console.log('After setting - editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      const editModal = document.getElementById("editModal");
      const editInput = document.getElementById("editInput");

      document.getElementById("editModalTitle").textContent = title;
      editInput.value = currentValue;

      if (type === 'score' || type === 'scoreChange') {
        editInput.type = 'number';
        editInput.min = '0';
      } else {
        editInput.type = 'text';
      }

      editModal.classList.add("show");
      console.log('Edit modal visible, editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      setTimeout(() => {
        editInput.focus();
        editInput.select();
      }, 50);
    }

    function closeEditModal() {
      document.getElementById("editModal").classList.remove("show");
      currentTeamIndex = null;
      editType = null;
    }

    function saveEdit() {
      console.log('saveEdit called, editType:', editType, 'currentTeamIndex:', currentTeamIndex);
      const value = document.getElementById("editInput").value;
      console.log('Input value:', value);

      if (editType === 'name' && value.trim()) {
        console.log('Saving team name');
        teams[currentTeamIndex].name = value.trim();
        saveData();
        renderScoreboard();
        closeEditModal();
      } else if (editType === 'score') {
        const num = parseInt(value);
        console.log('Parsed score:', num);
        if (!isNaN(num) && num >= 0) {
          console.log('Saving team score');
          teams[currentTeamIndex].score = num;
          saveData();
          renderScoreboard();
          closeEditModal();
        }
      } else if (editType === 'scoreChange') {
        const amount = parseInt(value);
        console.log('Parsed score change amount:', amount);
        if (!isNaN(amount) && amount > 0) {
          const delta = changeScore.delta;
          console.log('Delta:', delta, 'applying change');
          if (delta > 0) {
            teams[currentTeamIndex].score += amount;
          } else {
            teams[currentTeamIndex].score = Math.max(0, teams[currentTeamIndex].score - amount);
          }
          saveData();
          renderScoreboard();
          closeEditModal();
        }
      } else {
        console.log('No valid save condition met');
      }
    }

    function verifyPin() {
      const input = document.getElementById("pinInput").value;

      // Check if already processing
      if (verifyPin.isProcessing) {
        console.log('Already processing, ignoring duplicate call');
        return;
      }

      console.log('Verifying PIN, editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      if (input === PIN) {
        verifyPin.isProcessing = true;

        // Save editType and currentTeamIndex before closing modal
        const savedEditType = editType;
        const savedTeamIndex = currentTeamIndex;
        const savedAction = currentAction;

        console.log('Saved values - editType:', savedEditType, 'teamIndex:', savedTeamIndex, 'hasAction:', !!savedAction);

        closeModal();

        // Use setTimeout to ensure modal closes before opening edit modal
        setTimeout(() => {
          console.log('Inside setTimeout - editType:', savedEditType, 'teamIndex:', savedTeamIndex);
          if (savedAction) {
            console.log('Executing currentAction');
            savedAction();
          }
          else if (savedEditType === 'name') {
            console.log('Opening name edit modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            showEditModal(`Rediger ${teams[savedTeamIndex].name}`, teams[savedTeamIndex].name, savedEditType);
          } else if (savedEditType === 'score') {
            console.log('Opening score edit modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            showEditModal(`Rediger point for ${teams[savedTeamIndex].name}`, teams[savedTeamIndex].score, savedEditType);
          } else if (savedEditType === 'scoreChange') {
            console.log('Opening score change modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            const delta = changeScore.delta;
            const action = delta > 0 ? 'Tilf√∏j' : 'Fjern';
            showEditModal(`${action} point for ${teams[savedTeamIndex].name}`, Math.abs(delta), savedEditType);
          } else {
            console.log('No matching condition - savedEditType:', savedEditType, 'savedAction:', savedAction);
          }

          verifyPin.isProcessing = false;
        }, 150);
      } else {
        document.getElementById("errorMsg").textContent = "Forkert PIN - pr√∏v igen";
        document.getElementById("pinInput").value = "";
        document.getElementById("pinInput").focus();
      }
    }    // ===== TASK FUNCTIONS =====

    function renderTaskGrid() {
      const grid = document.getElementById("taskGrid");
      grid.innerHTML = "";

      tasks.forEach((task, idx) => {
        if (completedTasks.includes(idx)) return; // Skip completed tasks

        const card = document.createElement("div");
        card.className = "task-card";
        card.onclick = () => openTask(idx);

        card.innerHTML = `
          <div class="task-card-number">Opgave ${idx + 1}</div>
          <div class="task-card-title">${task.title}</div>
          <div class="task-card-description">${task.description}</div>
        `;

        grid.appendChild(card);
      });

      if (completedTasks.length === tasks.length) {
        grid.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: var(--muted);"><div style="font-size: 48px; margin-bottom: 16px;">üéâ</div><div style="font-size: 24px; font-weight: 600;">Alle opgaver gennemf√∏rt!</div><div style="margin-top: 12px;">Tryk "Nulstil Opgaver" for at starte forfra</div></div>';
      }
    }

    function openTask(index) {
      if (completedTasks.includes(index)) {
        alert("Denne opgave er allerede gennemf√∏rt!");
        return;
      }
      currentTaskIndex = index;
      document.getElementById("tasksOverview").classList.add("hidden");
      document.getElementById("taskDetail").classList.add("active");
      renderTask();
    }

    function showTasksOverview() {
      document.getElementById("taskDetail").classList.remove("active");
      document.getElementById("tasksOverview").classList.remove("hidden");
    }

    function completeTask(taskIndex) {
      if (!completedTasks.includes(taskIndex)) {
        completedTasks.push(taskIndex);
        saveData();
        renderTaskGrid();
        showTasksOverview();
      }
    }

    function completeTask(taskIndex) {
      if (!completedTasks.includes(taskIndex)) {
        completedTasks.push(taskIndex);
        saveData();
        renderTaskGrid();
        showTasksOverview();
      }
    }

    function renderTask() {
      const task = tasks[currentTaskIndex];
      document.getElementById("taskCounter").textContent = `Opgave ${currentTaskIndex + 1}/${tasks.length}`;
      document.getElementById("taskTitle").textContent = task.title;
      document.getElementById("taskDescription").textContent = task.description;

      const content = document.getElementById("taskContent");

      switch (task.type) {
        case "emoji-songs":
          renderEmojiSongsTask(content);
          break;
        case "click-challenge":
          renderClickChallengeTask(content);
          break;
        case "beer-pong":
          renderBeerPongTask(content);
          break;
        case "physiology-quiz":
          renderPhysiologyQuizTask(content);
          break;
        case "trick-host":
          renderTrickHostTask(content);
          break;
        case "straw-challenge":
          renderStrawChallengeTask(content);
          break;
        case "beerbong-challenge":
          renderBeerBongTask(content);
          break;
        case "strava-run":
          renderStravaRunTask(content);
          break;
        case "yatzy-challenge":
          renderYatzyChallengeTask(content);
          break;
        default:
          content.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--muted);">
              <p style="font-size: 20px;">Denne opgave er endnu ikke tilg√¶ngelig</p>
            </div>
          `;
          document.getElementById("taskStatus").textContent = "Ikke tilg√¶ngelig";
      }
    }

    function nextTask() {
      if (currentTaskIndex < tasks.length - 1) {
        currentTaskIndex++;
        renderTask();
      }
    }

    function previousTask() {
      if (currentTaskIndex > 0) {
        currentTaskIndex--;
        renderTask();
      }
    }

    // ===== TASK RENDERS =====

    // 1. EMOJI SONGS TASK
    function renderEmojiSongsTask(container) {
      const songs = [
        { emoji: "üÉèüé∞üòê", answer: "pokerface", title: "Pokerface - Lady Gaga" },
        { emoji: "‚ö°üå©Ô∏èüí•", answer: "thunderstruck", title: "Thunderstruck - AC/DC" },
        { emoji: "üó∫Ô∏èüìçüß≠", answer: "maps", title: "Maps - Maroon 5" },
        { emoji: "üîüüìÖ‚è∞", answer: "10 √•r", title: "10 √•r - Emil Lange" },
        { emoji: "üí°üî¶‚ú®", answer: "skarpt lys", title: "Skarpt Lys - Gilli" },
        { emoji: "üèóÔ∏èüö®‚ö†Ô∏è", answer: "kranalarm", title: "Kranalarm - Jesubr√∏dre" },
        { emoji: "üç¨üé®üñåÔ∏è", answer: "candy paint", title: "Candy Paint - Post Malone" },
        { emoji: "üá©üá™üñ§‚ù§Ô∏èüíõ", answer: "deutschland", title: "Deutschland - Rammstein" },
        { emoji: "üíÉüëëüéµ", answer: "dancing queen", title: "Dancing Queen - ABBA" },
        { emoji: "üïäÔ∏è‚òÆÔ∏èü§ù", answer: "fred", title: "Fred - Bo Evers" }
      ];

      let currentS = 0;
      let answered = false;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Sang ${currentS + 1}/${songs.length}
            </div>
            <div style="font-size: 64px; margin: 30px 0;">
              ${songs[currentS].emoji}
            </div>
            
            ${!answered ? `
              <div style="max-width: 400px; margin: 20px auto;">
                <input 
                  type="text" 
                  id="songGuess" 
                  placeholder="Skriv dit g√¶t her..." 
                  style="width: 100%; padding: 16px; font-size: 18px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text); text-align: center;"
                  onkeypress="if(event.key==='Enter'){event.preventDefault();emojiCheckGuess();}"
                >
              </div>
              <button class="btn primary" onclick="emojiCheckGuess()" style="margin-top: 20px;">Tjek svar</button>
            ` : `
              <div style="font-size: 20px; margin: 20px 0; min-height: 60px; color: var(--ok);">
                ‚úì Korrekt! üéµ ${songs[currentS].title}
              </div>
              <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                ${currentS < songs.length - 1 ? '<button class="btn primary" onclick="emojiNext()">N√¶ste ‚Üí</button>' : '<button class="btn primary" onclick="emojiFinish()">F√¶rdig! ‚úì</button>'}
              </div>
            `}
          </div>
        `;
        if (!answered) {
          setTimeout(() => document.getElementById("songGuess")?.focus(), 100);
        }
      }

      window.emojiCheckGuess = () => {
        const guess = document.getElementById("songGuess")?.value.toLowerCase().trim() || '';
        const answer = songs[currentS].answer.toLowerCase().trim();

        console.log('Guess:', guess, 'Answer:', answer, 'Match:', guess === answer);

        // Check if guess matches the answer exactly
        if (guess === answer) {
          answered = true;
          render();
        } else {
          // Wrong answer - shake the input or show error
          const input = document.getElementById("songGuess");
          if (input) {
            input.style.borderColor = 'var(--bad)';
            input.value = '';
            input.placeholder = 'Forkert - pr√∏v igen!';
            setTimeout(() => {
              input.style.borderColor = '';
              input.placeholder = 'Skriv dit g√¶t her...';
            }, 1500);
          }
        }
      }; window.emojiNext = () => { if (currentS < songs.length - 1) { currentS++; answered = false; render(); } };
      window.emojiFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üéµ</div><div style="font-size: 24px; font-weight: 600;">Alle sange gennemg√•et!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "I gang";
    }

    // 2. CLICK CHALLENGE TASK
    function renderClickChallengeTask(container) {
      let clicks = 0;
      let timeLeft = 10;
      let timerInterval = null;
      let started = false;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Tryk p√• knappen mere end 75 gange p√• 10 sekunder!
            </div>
            
            <div style="font-size: 80px; font-weight: 700; color: var(--accent); margin: 30px 0;">
              ${clicks}
            </div>
            
            <div style="font-size: 32px; font-weight: 600; margin: 20px 0; color: ${timeLeft <= 3 ? 'var(--bad)' : 'var(--text)'};">
              ${timeLeft}s
            </div>
            
            ${!started ? `
              <button class="btn primary" onclick="startClicking()" style="font-size: 20px; padding: 20px 40px; margin-top: 20px;">
                Start! üöÄ
              </button>
            ` : timeLeft > 0 ? `
              <button class="btn primary" onclick="incrementClick()" style="font-size: 24px; padding: 30px 60px; margin-top: 20px;">
                KLIK! üñ±Ô∏è
              </button>
            ` : `
              <div style="margin-top: 30px;">
                ${clicks >= 75 ? `
                  <div style="font-size: 28px; color: var(--ok); margin-bottom: 20px;">
                    ‚úÖ Du klarede det! ${clicks} klik!
                  </div>
                  <button class="btn primary" onclick="clickFinish()">Forts√¶t ‚Üí</button>
                ` : `
                  <div style="font-size: 28px; color: var(--bad); margin-bottom: 20px;">
                    ‚ùå Ikke nok klik! Kun ${clicks}/75
                  </div>
                  <button class="btn" onclick="clickRetry()">Pr√∏v igen</button>
                `}
              </div>
            `}
          </div>
        `;
      }

      window.startClicking = () => {
        started = true;
        clicks = 0;
        timeLeft = 10;
        render();

        timerInterval = setInterval(() => {
          timeLeft--;
          render();

          if (timeLeft <= 0) {
            clearInterval(timerInterval);
          }
        }, 1000);
      };

      window.incrementClick = () => {
        if (timeLeft > 0) {
          clicks++;
          render();
        }
      };

      window.clickRetry = () => {
        started = false;
        clicks = 0;
        timeLeft = 10;
        if (timerInterval) clearInterval(timerInterval);
        render();
      };

      window.clickFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üñ±Ô∏è</div><div style="font-size: 24px; font-weight: 600;">Klik-udfordring gennemf√∏rt!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "Klar";
    }

    // 3. BEER PONG TASK
    function renderBeerPongTask(container) {
      let verified = false;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 24px; font-weight: 600; margin-bottom: 30px; line-height: 1.4;">
              Kast en beer pong bold i koppen 4 gange i streg! üç∫
            </div>
            
            <div style="font-size: 64px; margin: 40px 0;">
              üèì ‚Üí ü•§
            </div>
            
            <div style="font-size: 18px; color: var(--muted); margin: 30px 20px; line-height: 1.6;">
              N√•r I har klaret udfordringen, skal v√¶rten indtaste PIN-koden for at bekr√¶fte.
            </div>
            
            ${!verified ? `
              <div style="margin-top: 40px;">
                <input 
                  type="password" 
                  id="beerPongPin" 
                  placeholder="Indtast PIN..." 
                  style="width: 200px; padding: 16px; font-size: 18px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text); text-align: center; margin-bottom: 12px;"
                  onkeypress="if(event.key==='Enter'){event.preventDefault();verifyBeerPong();}"
                >
                <div id="beerPongError" style="color: var(--bad); font-size: 14px; min-height: 20px; margin-bottom: 12px;"></div>
                <button class="btn primary" onclick="verifyBeerPong()">Bekr√¶ft ‚úì</button>
              </div>
            ` : `
              <div style="margin-top: 40px;">
                <div style="font-size: 28px; color: var(--ok); margin-bottom: 20px;">
                  ‚úÖ Bekr√¶ftet af v√¶rt!
                </div>
                <button class="btn primary" onclick="beerPongFinish()">Forts√¶t ‚Üí</button>
              </div>
            `}
          </div>
        `;
        if (!verified) {
          setTimeout(() => document.getElementById("beerPongPin")?.focus(), 100);
        }
      }

      window.verifyBeerPong = () => {
        const input = document.getElementById("beerPongPin")?.value || '';
        const errorDiv = document.getElementById("beerPongError");

        if (input === PIN) {
          verified = true;
          render();
        } else {
          errorDiv.textContent = "Forkert PIN - pr√∏v igen";
          document.getElementById("beerPongPin").value = "";
          setTimeout(() => {
            errorDiv.textContent = "";
          }, 2000);
        }
      };

      window.beerPongFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üç∫</div><div style="font-size: 24px; font-weight: 600;">Beer Pong udfordring gennemf√∏rt!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "Klar til at starte";
    }

    // 4. PHYSIOLOGY QUIZ TASK
    function renderPhysiologyQuizTask(container) {
      const questions = [
        {
          q: "Hvad er det normale hvile-hjerterate for en voksen?",
          answer: "60-100",
          hint: "Angiv som interval"
        },
        {
          q: "Hvor mange liter blod pumper hjertet cirka per minut i hvile?",
          answer: "5",
          hint: ""
        },
        {
          q: "Hvad hedder det protein i r√∏de blodlegemer der transporterer ilt?",
          answer: "h√¶moglobin",
          hint: ""
        },
        {
          q: "Hvor mange kranienervepar har mennesket?",
          answer: "12",
          hint: ""
        },
        {
          q: "Hvad er det normale pH-niveau i blodet?",
          answer: "7.4",
          hint: ""
        }
      ];

      let currentQ = 0;
      let answered = false;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Sp√∏rgsm√•l ${currentQ + 1}/${questions.length}
            </div>
            <div style="font-size: 22px; font-weight: 600; margin-bottom: 30px; line-height: 1.4;">
              ${questions[currentQ].q}
            </div>
            
            ${!answered ? `
              <div style="max-width: 400px; margin: 20px auto;">
                <div style="font-size: 14px; color: var(--muted); margin-bottom: 8px;">
                  ${questions[currentQ].hint}
                </div>
                <input 
                  type="text" 
                  id="physioAnswer" 
                  placeholder="Dit svar..." 
                  style="width: 100%; padding: 16px; font-size: 18px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text); text-align: center;"
                  onkeypress="if(event.key==='Enter'){event.preventDefault();checkPhysioAnswer();}"
                >
              </div>
              <button class="btn primary" onclick="checkPhysioAnswer()" style="margin-top: 20px;">Tjek svar</button>
            ` : `
              <div style="font-size: 20px; margin: 20px 0; min-height: 60px; color: var(--ok);">
                ‚úì Korrekt! Svaret er: ${questions[currentQ].answer}
              </div>
              <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                ${currentQ < questions.length - 1 ? '<button class="btn primary" onclick="physioNext()">N√¶ste ‚Üí</button>' : '<button class="btn primary" onclick="physioFinish()">F√¶rdig! ‚úì</button>'}
              </div>
            `}
          </div>
        `;
        if (!answered) {
          setTimeout(() => document.getElementById("physioAnswer")?.focus(), 100);
        }
      }

      window.checkPhysioAnswer = () => {
        const guess = document.getElementById("physioAnswer")?.value.toLowerCase().trim() || '';
        const answer = questions[currentQ].answer.toLowerCase().trim();

        console.log('Guess:', guess, 'Answer:', answer, 'Match:', guess === answer);

        // Check if guess matches the answer exactly
        if (guess === answer) {
          answered = true;
          render();
        } else {
          // Wrong answer - shake the input
          const input = document.getElementById("physioAnswer");
          if (input) {
            input.style.borderColor = 'var(--bad)';
            input.value = '';
            input.placeholder = 'Forkert - pr√∏v igen!';
            setTimeout(() => {
              input.style.borderColor = '';
              input.placeholder = 'Dit svar...';
            }, 1500);
          }
        }
      };

      window.physioNext = () => {
        if (currentQ < questions.length - 1) {
          currentQ++;
          answered = false;
          render();
        }
      };

      window.physioFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üß†</div><div style="font-size: 24px; font-weight: 600;">Fysiologi quiz gennemf√∏rt!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "I gang";
    }

    // 5. TRICK HOST TASK
    function renderTrickHostTask(container) {
      let verified = false;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 24px; font-weight: 600; margin-bottom: 30px; line-height: 1.4;">
              Snyd V√¶rten! ü•É
            </div>
            
            <div style="font-size: 18px; color: var(--text); margin: 30px 20px; line-height: 1.6; max-width: 600px; margin-left: auto; margin-right: auto;">
              <p style="margin-bottom: 16px;"><strong>S√•dan spiller I:</strong></p>
              <p style="margin-bottom: 12px;">1. V√¶lg en spiller der skal drikke</p>
              <p style="margin-bottom: 12px;">2. Spilleren v√¶lger HEMMELIGT mellem vand üíß eller sambuca ü•É</p>
              <p style="margin-bottom: 12px;">3. Spilleren drikker shottet og pr√∏ver at holde masken!</p>
              <p style="margin-bottom: 12px;">4. V√¶rten skal g√¶tte hvad der blev drukket</p>
              <p style="margin-bottom: 12px;">5. N√•r v√¶rten har g√¶ttet, indtaster v√¶rten PIN-koden</p>
            </div>
            
            <div style="font-size: 64px; margin: 40px 0;">
              üíß eller ü•É ?
            </div>
            
            ${!verified ? `
              <div style="margin-top: 40px;">
                <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
                  V√¶rt: Har du g√¶ttet rigtigt? Indtast PIN for at bekr√¶fte
                </div>
                <input 
                  type="password" 
                  id="trickHostPin" 
                  placeholder="Indtast PIN..." 
                  style="width: 200px; padding: 16px; font-size: 18px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text); text-align: center; margin-bottom: 12px;"
                  onkeypress="if(event.key==='Enter'){event.preventDefault();verifyTrickHost();}"
                >
                <div id="trickHostError" style="color: var(--bad); font-size: 14px; min-height: 20px; margin-bottom: 12px;"></div>
                <button class="btn primary" onclick="verifyTrickHost()">Bekr√¶ft ‚úì</button>
              </div>
            ` : `
              <div style="margin-top: 40px;">
                <div style="font-size: 28px; color: var(--ok); margin-bottom: 20px;">
                  ‚úÖ V√¶rten har godkendt!
                </div>
                <button class="btn primary" onclick="trickHostFinish()">Forts√¶t ‚Üí</button>
              </div>
            `}
          </div>
        `;
        if (!verified) {
          setTimeout(() => document.getElementById("trickHostPin")?.focus(), 100);
        }
      }

      window.verifyTrickHost = () => {
        const input = document.getElementById("trickHostPin")?.value || '';
        const errorDiv = document.getElementById("trickHostError");

        if (input === PIN) {
          verified = true;
          render();
        } else {
          errorDiv.textContent = "Forkert PIN - pr√∏v igen";
          document.getElementById("trickHostPin").value = "";
          setTimeout(() => {
            errorDiv.textContent = "";
          }, 2000);
        }
      };

      window.trickHostFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">ü•É</div><div style="font-size: 24px; font-weight: 600;">Snyd V√¶rten gennemf√∏rt!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "Klar til at snyde!";
    }

    // 6. STRAW CHALLENGE TASK
    function renderStrawChallengeTask(container) {
      let verified = false;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 24px; font-weight: 600; margin-bottom: 30px; line-height: 1.4;">
              Drik en √∏l gennem et suger√∏r! üç∫ü•§
            </div>
            
            <div style="font-size: 64px; margin: 40px 0;">
              üç∫ ‚Üí ü•§ ‚Üí üòµ‚Äçüí´
            </div>
            
            <div style="font-size: 18px; color: var(--text); margin: 30px 20px; line-height: 1.6;">
              En spiller skal drikke en hel √∏l gennem et suger√∏r!<br>
              V√¶rten bekr√¶fter med PIN n√•r opgaven er fuldf√∏rt.
            </div>
            
            ${!verified ? `
              <div style="margin-top: 40px;">
                <input 
                  type="password" 
                  id="strawPin" 
                  placeholder="Indtast PIN..." 
                  style="width: 200px; padding: 16px; font-size: 18px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text); text-align: center; margin-bottom: 12px;"
                  onkeypress="if(event.key==='Enter'){event.preventDefault();verifyStraw();}"
                >
                <div id="strawError" style="color: var(--bad); font-size: 14px; min-height: 20px; margin-bottom: 12px;"></div>
                <button class="btn primary" onclick="verifyStraw()">Bekr√¶ft ‚úì</button>
              </div>
            ` : `
              <div style="margin-top: 40px;">
                <div style="font-size: 28px; color: var(--ok); margin-bottom: 20px;">
                  ‚úÖ Bekr√¶ftet af v√¶rt!
                </div>
                <button class="btn primary" onclick="strawFinish()">Forts√¶t ‚Üí</button>
              </div>
            `}
          </div>
        `;
        if (!verified) {
          setTimeout(() => document.getElementById("strawPin")?.focus(), 100);
        }
      }

      window.verifyStraw = () => {
        const input = document.getElementById("strawPin")?.value || '';
        const errorDiv = document.getElementById("strawError");

        if (input === PIN) {
          verified = true;
          render();
        } else {
          errorDiv.textContent = "Forkert PIN - pr√∏v igen";
          document.getElementById("strawPin").value = "";
          setTimeout(() => {
            errorDiv.textContent = "";
          }, 2000);
        }
      };

      window.strawFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">ü•§</div><div style="font-size: 24px; font-weight: 600;">Suger√∏rs challenge gennemf√∏rt!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "Klar til at drikke";
    }

    // 7. BEER BONG CHALLENGE TASK
    function renderBeerBongTask(container) {
      let verified = false;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 24px; font-weight: 600; margin-bottom: 20px;">
              √òlbong Challenge ‚ö°üç∫
            </div>
            
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 30px; line-height: 1.6;">
              Tag en √∏lbong p√• under 2,5 sekunder!<br>
              V√¶rten skal bekr√¶fte med pinkode n√•r det er gjort.
            </div>
            
            <div style="font-size: 64px; margin: 40px 0;">
              üç∫‚ö°
            </div>
            
            ${!verified ? `
              <div style="max-width: 300px; margin: 30px auto;">
                <div style="font-size: 18px; margin-bottom: 12px; color: var(--text);">
                  V√¶rt PIN-kode:
                </div>
                <input 
                  type="password" 
                  id="beerBongPin" 
                  placeholder="Indtast PIN" 
                  style="width: 100%; padding: 16px; font-size: 18px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text); text-align: center;"
                  onkeypress="if(event.key==='Enter'){event.preventDefault();verifyBeerBong();}"
                >
                <div id="beerBongError" style="color: var(--bad); margin-top: 12px; min-height: 24px;"></div>
                <button class="btn primary" onclick="verifyBeerBong()" style="margin-top: 20px; width: 100%;">Bekr√¶ft üç∫</button>
              </div>
            ` : `
              <div style="margin-top: 40px;">
                <div style="font-size: 28px; color: var(--ok); margin-bottom: 20px;">
                  ‚úÖ Bekr√¶ftet af v√¶rt!
                </div>
                <button class="btn primary" onclick="beerBongFinish()">Forts√¶t ‚Üí</button>
              </div>
            `}
          </div>
        `;
        if (!verified) {
          setTimeout(() => document.getElementById("beerBongPin")?.focus(), 100);
        }
      }

      window.verifyBeerBong = () => {
        const input = document.getElementById("beerBongPin")?.value || '';
        const errorDiv = document.getElementById("beerBongError");

        if (input === PIN) {
          verified = true;
          render();
        } else {
          errorDiv.textContent = "Forkert PIN - pr√∏v igen";
          document.getElementById("beerBongPin").value = "";
          setTimeout(() => {
            errorDiv.textContent = "";
          }, 2000);
        }
      };

      window.beerBongFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">‚ö°üç∫</div><div style="font-size: 24px; font-weight: 600;">√òlbong challenge gennemf√∏rt!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "Klar til √∏lbong";
    }

    // 8. STRAVA RUN CHALLENGE TASK
    function renderStravaRunTask(container) {
      let verified = false;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 24px; font-weight: 600; margin-bottom: 20px;">
              Strava L√∏b Challenge üèÉ‚Äç‚ôÇÔ∏è
            </div>
            
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 30px; line-height: 1.6;">
              L√∏b en kilometer og vis bevis fra Strava!<br>
              V√¶rten skal bekr√¶fte med pinkode n√•r det er gjort.
            </div>
            
            <div style="font-size: 64px; margin: 40px 0;">
              üèÉ‚Äç‚ôÇÔ∏èüì±
            </div>
            
            ${!verified ? `
              <div style="max-width: 300px; margin: 30px auto;">
                <div style="font-size: 18px; margin-bottom: 12px; color: var(--text);">
                  V√¶rt PIN-kode:
                </div>
                <input 
                  type="password" 
                  id="stravaPin" 
                  placeholder="Indtast PIN" 
                  style="width: 100%; padding: 16px; font-size: 18px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text); text-align: center;"
                  onkeypress="if(event.key==='Enter'){event.preventDefault();verifyStrava();}"
                >
                <div id="stravaError" style="color: var(--bad); margin-top: 12px; min-height: 24px;"></div>
                <button class="btn primary" onclick="verifyStrava()" style="margin-top: 20px; width: 100%;">‚úÖ Bekr√¶ft l√∏b</button>
              </div>
            ` : `
              <div style="margin-top: 40px;">
                <div style="font-size: 28px; color: var(--ok); margin-bottom: 20px;">
                  ‚úÖ Bekr√¶ftet af v√¶rt!
                </div>
                <button class="btn primary" onclick="stravaFinish()">Forts√¶t ‚Üí</button>
              </div>
            `}
          </div>
        `;
        if (!verified) {
          setTimeout(() => document.getElementById("stravaPin")?.focus(), 100);
        }
      }

      window.verifyStrava = () => {
        const input = document.getElementById("stravaPin")?.value || '';
        const errorDiv = document.getElementById("stravaError");

        if (input === PIN) {
          verified = true;
          render();
        } else {
          errorDiv.textContent = "Forkert PIN - pr√∏v igen";
          document.getElementById("stravaPin").value = "";
          setTimeout(() => {
            errorDiv.textContent = "";
          }, 2000);
        }
      };

      window.stravaFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üèÉ‚Äç‚ôÇÔ∏èüèÜ</div><div style="font-size: 24px; font-weight: 600;">Strava l√∏b gennemf√∏rt!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "Klar til at l√∏be";
    }

    // 9. YATZY CHALLENGE TASK
    function renderYatzyChallengeTask(container) {
      let dice = [null, null, null, null, null];
      let rolling = false;
      let attempts = 0;

      function rollDice() {
        if (rolling) return;
        rolling = true;
        attempts++;

        let rollCount = 0;
        const rollInterval = setInterval(() => {
          dice = dice.map(() => Math.floor(Math.random() * 6) + 1);
          render();
          rollCount++;

          if (rollCount >= 10) {
            clearInterval(rollInterval);
            rolling = false;
            checkYatzy();
            render();
          }
        }, 100);
      }

      function checkYatzy() {
        if (dice.some(d => d === null)) return false;
        const allSame = dice.every(d => d === dice[0]);
        return allSame;
      }

      function render() {
        const isYatzy = checkYatzy();
        const diceEmojis = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];

        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 24px; font-weight: 600; margin-bottom: 20px;">
              Sl√• Yatzy med 5 terninger! üé≤
            </div>
            
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 30px;">
              Alle 5 terninger skal vise samme v√¶rdi!
            </div>
            
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin: 40px 0;">
              ${dice.map(d => `<div style="font-size: 64px;">${d === null ? '‚ùì' : diceEmojis[d - 1]}</div>`).join('')}
            </div>
            
            ${isYatzy && !rolling ? `
              <div style="font-size: 28px; color: var(--ok); margin: 30px 0; font-weight: 600;">
                üéâ YATZY! Du klarede det p√• ${attempts} fors√∏g!
              </div>
              <button class="btn primary" onclick="yatzyFinish()">Forts√¶t ‚Üí</button>
            ` : `
              <div style="font-size: 18px; color: var(--muted); margin: 20px 0;">
                Fors√∏g: ${attempts}
              </div>
              <button class="btn primary" onclick="rollYatzy()" ${rolling ? 'disabled' : ''} style="font-size: 20px; padding: 20px 40px;">
                ${rolling ? 'Ruller...' : 'üé≤ Sl√• terningerne!'}
              </button>
            `}
          </div>
        `;
      }

      window.rollYatzy = rollDice;


      window.yatzyReset = () => {
        dice = [null, null, null, null, null];
        rolling = false;
        attempts = 0;
        render();
      }; window.yatzyFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üé≤</div><div style="font-size: 24px; font-weight: 600;">Yatzy challenge gennemf√∏rt!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "Klar til at rulle";
    }

    // 8. ROULETTE TASK
    function renderRouletteTask(container) {
      let spinning = false;
      let result = 0;

      function spin() {
        if (spinning) return;
        spinning = true;

        let spins = 0;
        const maxSpins = 20;

        const interval = setInterval(() => {
          result = Math.floor(Math.random() * 6) + 1;
          document.getElementById("rouletteNumber").textContent = result;
          spins++;

          if (spins >= maxSpins) {
            clearInterval(interval);
            spinning = false;
            document.getElementById("rouletteResult").innerHTML = `
              <div style="font-size: 20px; color: var(--accent); margin-top: 20px;">
                ${result === 1 ? 'üíÄ TAK 1 SHOT!' : result === 6 ? 'üéâ FORDEL 2 SHOTS!' : 'üòÖ Denne gang slap du!'}
              </div>
            `;
          }
        }, 100);
      }

      container.innerHTML = `
        <div style="text-align: center;">
          <div style="font-size: 120px; font-weight: 700; color: var(--accent); margin: 40px 0;" id="rouletteNumber">?</div>
          <button class="btn primary" onclick="spinRoulette()" style="font-size: 18px; padding: 16px 32px;">üé≤ Spin!</button>
          <div id="rouletteResult"></div>
          <div style="margin-top: 40px; font-size: 14px; color: var(--muted);">
            1 = Tag 1 shot | 6 = Fordel 2 shots | Andet = Ingenting
          </div>
          <div style="margin-top: 40px;">
            <button class="btn" onclick="rouletteFinish()">Afslut opgave ‚úì</button>
          </div>
        </div>
      `;

      window.spinRoulette = spin;
      window.rouletteFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üé≤</div><div style="font-size: 24px; font-weight: 600;">Roulette afsluttet!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };
      document.getElementById("taskStatus").textContent = "Klar til spin";
    }

    // 4. MOST LIKELY TASK
    function renderMostLikelyTask(container) {
      const questions = [
        "Hvem ville mest sandsynligt falde i s√∏vn f√∏rst til en fest?",
        "Hvem ville mest sandsynligt overleve en zombie-apokalypse?",
        "Hvem ville mest sandsynligt blive million√¶r?",
        "Hvem ville mest sandsynligt ende i f√¶ngsel?",
        "Hvem ville mest sandsynligt gifte sig f√∏rst?",
        "Hvem ville mest sandsynligt spise det v√¶mmeligste?",
        "Hvem ville mest sandsynligt blive ber√∏mt?",
        "Hvem ville mest sandsynligt glemme deres egen f√∏dselsdag?"
      ];

      let currentQ = 0;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Sp√∏rgsm√•l ${currentQ + 1}/${questions.length}
            </div>
            <div style="font-size: 24px; font-weight: 600; margin: 40px 20px; line-height: 1.5;">
              ${questions[currentQ]}
            </div>
            <div style="font-size: 16px; color: var(--muted); margin: 30px 0;">
              Point p√• personen n√•r I er klar!
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 40px;">
              ${currentQ < questions.length - 1 ? '<button class="btn primary" onclick="mostLikelyNext()">N√¶ste ‚Üí</button>' : '<button class="btn primary" onclick="mostLikelyFinish()">F√¶rdig! ‚úì</button>'}
            </div>
          </div>
        `;
      }

      window.mostLikelyNext = () => { if (currentQ < questions.length - 1) { currentQ++; render(); } };
      window.mostLikelyFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üëÜ</div><div style="font-size: 24px; font-weight: 600;">Alle sp√∏rgsm√•l gennemg√•et!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "I gang";
    }

    // 5. TRUTH OR DRINK TASK
    function renderTruthOrDrinkTask(container) {
      const questions = [
        "Hvad er det mest pinlige, du har gjort til en fest?",
        "Hvem i rummet ville du kysse, hvis du skulle?",
        "Hvad er din hemmelige guilty pleasure?",
        "Hvad er det vildeste sted, du har haft sex?",
        "Hvem var din f√∏rste k√¶reste, og hvorfor sluttede det?",
        "Hvad er den v√¶rste l√∏gn, du har fortalt dine for√¶ldre?",
        "Hvad er det mest ulovlige, du har gjort?",
        "Hvis du kun kunne se √©n person her igen, hvem ville det v√¶re?"
      ];

      let currentQ = 0;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Sp√∏rgsm√•l ${currentQ + 1}/${questions.length}
            </div>
            <div style="font-size: 24px; font-weight: 600; margin: 40px 20px; line-height: 1.5;">
              ${questions[currentQ]}
            </div>
            <div style="font-size: 16px; color: var(--muted); margin: 30px 0;">
              Besvar √¶rligt eller tag en stor slurk! üç∫
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 40px;">
              ${currentQ < questions.length - 1 ? '<button class="btn primary" onclick="truthNext()">N√¶ste ‚Üí</button>' : '<button class="btn primary" onclick="truthFinish()">F√¶rdig! ‚úì</button>'}
            </div>
          </div>
        `;
      }

      window.truthNext = () => { if (currentQ < questions.length - 1) { currentQ++; render(); } };
      window.truthFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üçª</div><div style="font-size: 24px; font-weight: 600;">I overlevede!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "I gang";
    }

    // ===== EVENT LISTENERS =====

    document.getElementById("pinOkBtn").addEventListener("click", verifyPin);

    document.getElementById("pinInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        verifyPin();
      }
    });

    document.getElementById("editOkBtn").addEventListener("click", saveEdit);

    document.getElementById("editInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        saveEdit();
      }
    });

    // Listen for localStorage changes from other tabs/devices
    window.addEventListener("storage", (e) => {
      if (e.key === "completedTasks") {
        // Reload completed tasks
        const savedTasks = localStorage.getItem("completedTasks");
        if (savedTasks) {
          try {
            completedTasks = JSON.parse(savedTasks);

            // Check if currently viewing a task that was just completed
            const taskDetail = document.getElementById("taskDetail");
            if (taskDetail.classList.contains("active") && completedTasks.includes(currentTaskIndex)) {
              // Task was completed by someone else - go back to overview
              showTasksOverview();
            }

            // Update the grid
            renderTaskGrid();
          } catch (e) {
            console.error("Kunne ikke indl√¶se opgaver");
          }
        }
      } else if (e.key === "scoreboardData") {
        // Reload scoreboard
        loadData();
        renderScoreboard();
      }
    });

    // ===== INITIALIZE =====
    loadData();
    renderScoreboard();
    renderTaskGrid();
  </script>
</body>

</html>