<!doctype html>
<html lang="da">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HOREBUKKENE - Julefrokost</title>
  <style>
    :root {
      --bg: #0b0d12;
      --card: rgba(255, 255, 255, .06);
      --text: rgba(255, 255, 255, .92);
      --muted: rgba(255, 255, 255, .65);
      --border: rgba(255, 255, 255, .12);
      --accent: #7c5cff;
      --ok: #24d18f;
      --bad: #ff5c7a;
      --shadow: 0 20px 60px rgba(0, 0, 0, .35);
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(800px 400px at 20% 0%, rgba(124, 92, 255, .25), transparent 60%),
        radial-gradient(800px 400px at 80% 10%, rgba(0, 255, 209, .12), transparent 60%),
        var(--bg);
      min-height: 100vh;
      padding: 24px;
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
    }

    .brand {
      font-size: 48px;
      line-height: 1.0;
      letter-spacing: -0.03em;
      margin: 0 0 24px 0;
      text-transform: uppercase;
      text-align: center;
    }

    /* Scoreboard Section */
    .scoreboard-section {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 24px;
      backdrop-filter: blur(12px);
      margin-bottom: 24px;
    }

    .scoreboard-title {
      font-size: 24px;
      font-weight: 600;
      margin: 0 0 16px 0;
      text-align: center;
    }

    .scoreboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .team {
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, .04);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all .2s;
    }

    .team:hover {
      background: rgba(255, 255, 255, .06);
      border-color: rgba(124, 92, 255, .3);
    }

    .team-name {
      font-size: 20px;
      font-weight: 600;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 8px;
      transition: background .2s;
    }

    .team-name:hover {
      background: rgba(255, 255, 255, .08);
    }

    .team-score {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .score-display {
      font-size: 32px;
      font-weight: 700;
      color: var(--accent);
      min-width: 60px;
      text-align: center;
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
      transition: background .2s;
    }

    .score-display:hover {
      background: rgba(124, 92, 255, .15);
    }

    .score-btn {
      width: 36px;
      height: 36px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .2);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .2s;
    }

    .score-btn:hover {
      background: rgba(124, 92, 255, .3);
      border-color: var(--accent);
    }

    .score-btn:active {
      transform: scale(0.95);
    }

    .scoreboard-controls {
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    /* Task Grid */
    .task-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .task-card {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-radius: 14px;
      padding: 24px;
      cursor: pointer;
      transition: all .2s;
      backdrop-filter: blur(12px);
    }

    .task-card:hover {
      background: linear-gradient(180deg, rgba(124, 92, 255, .15), rgba(124, 92, 255, .08));
      border-color: rgba(124, 92, 255, .4);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .task-card-number {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .task-card-title {
      font-size: 22px;
      font-weight: 600;
      margin: 0 0 12px 0;
    }

    .task-card-description {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
    }

    /* Task Detail View */
    .task-detail {
      display: none;
    }

    .task-detail.active {
      display: block;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .12);
      color: var(--text);
      padding: 10px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 15px;
      transition: all .2s;
      margin-bottom: 24px;
    }

    .back-btn:hover {
      background: rgba(124, 92, 255, .2);
      border-color: rgba(124, 92, 255, .4);
    }

    /* Task Section */
    .task-section {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 32px;
      backdrop-filter: blur(12px);
    }

    .tasks-overview {
      display: block;
    }

    .tasks-overview.hidden {
      display: none;
    }

    .task-header {
      margin-bottom: 24px;
    }

    .task-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 16px;
    }

    .pill {
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .12);
      padding: 6px 12px;
      border-radius: 999px;
    }

    .task-title {
      font-size: 28px;
      font-weight: 600;
      margin: 0 0 12px 0;
    }

    .task-description {
      font-size: 16px;
      color: var(--muted);
      line-height: 1.5;
    }

    .task-content {
      margin: 24px 0;
    }

    /* Alphabet Task */
    .alphabet-input {
      width: 100%;
      border: 2px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 16px;
      border-radius: 14px;
      font-size: 24px;
      text-align: center;
      letter-spacing: 2px;
      outline: none;
      backdrop-filter: blur(10px);
      font-family: monospace;
      margin-bottom: 16px;
    }

    .alphabet-input:focus {
      border-color: var(--accent);
    }

    .alphabet-input.success {
      border-color: var(--ok);
    }

    .alphabet-input.error {
      border-color: var(--bad);
    }

    .timer {
      font-size: 48px;
      font-weight: 700;
      text-align: center;
      margin: 20px 0;
      color: var(--accent);
    }

    .timer.warning {
      color: var(--bad);
      animation: pulse 0.5s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.6;
      }
    }

    .feedback {
      text-align: center;
      font-size: 18px;
      margin: 16px 0;
      min-height: 30px;
    }

    .feedback.ok {
      color: var(--ok);
    }

    .feedback.bad {
      color: var(--bad);
    }

    .btn {
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .12);
      color: var(--text);
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      transition: all .2s;
      font-weight: 500;
    }

    .btn:hover {
      background: rgba(124, 92, 255, .2);
      border-color: rgba(124, 92, 255, .4);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn.primary {
      background: rgba(124, 92, 255, .3);
      border-color: rgba(124, 92, 255, .5);
    }

    .task-nav {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-top: 24px;
    }

    /* Modal for PIN */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, .7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(180deg, rgba(255, 255, 255, .12), rgba(255, 255, 255, .06));
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 32px;
      max-width: 400px;
      width: 90%;
      box-shadow: var(--shadow);
    }

    .modal h2 {
      margin: 0 0 16px 0;
      font-size: 24px;
    }

    .modal input {
      width: 100%;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 12px;
      border-radius: 12px;
      font-size: 18px;
      text-align: center;
      letter-spacing: 4px;
      margin-bottom: 16px;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
    }

    .modal-buttons .btn {
      flex: 1;
    }

    .error-msg {
      color: var(--bad);
      font-size: 14px;
      margin-top: -8px;
      margin-bottom: 12px;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1 class="brand">üéÑ HOREBUKKENE üéÑ</h1>

    <!-- Scoreboard -->
    <div class="scoreboard-section">
      <h2 class="scoreboard-title">Scoreboard</h2>
      <div class="scoreboard" id="scoreboard"></div>
      <div class="scoreboard-controls">
        <button class="btn" onclick="resetScores()">Nulstil Point</button>
        <button class="btn" onclick="resetTasks()">Nulstil Opgaver</button>
      </div>
    </div>

    <!-- Task Area -->
    <div class="task-section">
      <!-- Overview of all tasks -->
      <div id="tasksOverview" class="tasks-overview">
        <h2 style="font-size: 32px; font-weight: 600; margin: 0 0 24px 0;">Opgaver</h2>
        <div class="task-grid" id="taskGrid"></div>
      </div>

      <!-- Individual task detail view -->
      <div id="taskDetail" class="task-detail">
        <button class="back-btn" onclick="showTasksOverview()">‚Üê Tilbage til opgaver</button>

        <div class="task-header">
          <div class="task-meta">
            <span class="pill" id="taskCounter">Opgave 1/5</span>
            <span class="pill" id="taskStatus">Ikke startet</span>
          </div>
          <h2 class="task-title" id="taskTitle">Alfabetet Challenge</h2>
          <p class="task-description" id="taskDescription">Skriv alfabetet a-z s√• hurtigt som muligt. Du skal g√∏re det
            p√•
            under 10 sekunder!</p>
        </div>

        <div class="task-content" id="taskContent">
          <!-- Task content will be inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- PIN Modal -->
  <div class="modal" id="pinModal">
    <div class="modal-content">
      <h2 id="modalTitle">Indtast PIN</h2>
      <input type="password" id="pinInput" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <div class="error-msg" id="errorMsg"></div>
      <div class="modal-buttons">
        <button class="btn" onclick="closeModal()">Annuller</button>
        <button class="btn" id="pinOkBtn">OK</button>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h2 id="editModalTitle">Rediger</h2>
      <input type="text" id="editInput" placeholder="" />
      <div class="modal-buttons">
        <button class="btn" onclick="closeEditModal()">Annuller</button>
        <button class="btn" id="editOkBtn" onclick="saveEdit()">Gem</button>
      </div>
    </div>
  </div>

  <script>
    const PIN = "0910";
    let teams = [
      { name: "Hold 1", score: 0 },
      { name: "Hold 2", score: 0 },
      { name: "Hold 3", score: 0 },
      { name: "Hold 4", score: 0 }
    ];

    let currentAction = null;
    let currentTeamIndex = null;
    let editType = null;

    // Task system
    let currentTaskIndex = 0;
    let completedTasks = [];
    const tasks = [
      {
        title: "Shots Trivia",
        description: "Hvem kender gruppen bedst? Svar p√• sp√∏rgsm√•l om jeres venner!",
        type: "trivia"
      },
      {
        title: "Find Sangen",
        description: "G√¶t sangen ud fra emoji! üéµ",
        type: "emoji-songs"
      },
      {
        title: "Shot Roulette",
        description: "Tal roulette - held og lykke! üé≤",
        type: "roulette"
      },
      {
        title: "Hvem Ville?",
        description: "Hvem i gruppen ville mest sandsynligt...?",
        type: "most-likely"
      },
      {
        title: "Druk eller Sandhed",
        description: "Besvar sp√∏rgsm√•l eller tag en t√•r! üç∫",
        type: "truth-or-drink"
      }
    ];

    // Alphabet task state
    let alphabetTimer = null;
    let alphabetStartTime = null;
    let alphabetElapsed = 0;
    let alphabetCompleted = false;

    // ===== SCOREBOARD FUNCTIONS =====

    function loadData() {
      const saved = localStorage.getItem("scoreboardData");
      if (saved) {
        try {
          teams = JSON.parse(saved);
        } catch (e) {
          console.error("Kunne ikke indl√¶se data");
        }
      }
      const savedTasks = localStorage.getItem("completedTasks");
      if (savedTasks) {
        try {
          completedTasks = JSON.parse(savedTasks);
        } catch (e) {
          console.error("Kunne ikke indl√¶se opgaver");
        }
      }
    }

    function saveData() {
      localStorage.setItem("scoreboardData", JSON.stringify(teams));
      localStorage.setItem("completedTasks", JSON.stringify(completedTasks));
    }

    function renderScoreboard() {
      const sb = document.getElementById("scoreboard");
      sb.innerHTML = "";

      teams.forEach((team, idx) => {
        const teamDiv = document.createElement("div");
        teamDiv.className = "team";
        teamDiv.innerHTML = `
          <div class="team-name" onclick="editTeamName(${idx})">${team.name}</div>
          <div class="team-score">
            <button class="score-btn" onclick="changeScore(${idx}, -1)">‚àí</button>
            <div class="score-display" onclick="editScore(${idx})">${team.score}</div>
            <button class="score-btn" onclick="changeScore(${idx}, 1)">+</button>
          </div>
        `;
        sb.appendChild(teamDiv);
      });
    }

    function changeScore(idx, delta) {
      currentTeamIndex = idx;
      editType = 'scoreChange';
      // Store the delta for later use
      changeScore.delta = delta;
      showPinModal(delta > 0 ? "Indtast PIN for at tilf√∏je point" : "Indtast PIN for at fjerne point");
    }

    function editScore(idx) {
      console.log('editScore called for team:', idx);
      currentTeamIndex = idx;
      editType = 'score';
      showPinModal("Indtast PIN for at √¶ndre point");
    }

    function editTeamName(idx) {
      console.log('editTeamName called for team:', idx);
      currentTeamIndex = idx;
      editType = 'name';
      showPinModal("Indtast PIN for at √¶ndre holdnavn");
    }

    function resetScores() {
      currentAction = () => {
        if (confirm("Er du sikker p√• at du vil nulstille alle point?")) {
          teams.forEach(t => t.score = 0);
          saveData();
          renderScoreboard();
        }
      };
      currentTeamIndex = null;
      showPinModal("Indtast PIN for at nulstille");
    }

    function resetTasks() {
      currentAction = () => {
        if (confirm("Er du sikker p√• at du vil nulstille alle opgaver?")) {
          completedTasks = [];
          saveData();
          renderTaskGrid();
          showTasksOverview();
        }
      };
      currentTeamIndex = null;
      showPinModal("Indtast PIN for at nulstille opgaver");
    }

    function showPinModal(title) {
      document.getElementById("modalTitle").textContent = title;
      document.getElementById("pinInput").value = "";
      document.getElementById("errorMsg").textContent = "";
      document.getElementById("pinModal").classList.add("show");
      document.getElementById("pinInput").focus();
    }

    function closeModal() {
      document.getElementById("pinModal").classList.remove("show");
      currentAction = null;
      currentTeamIndex = null;
      editType = null;
    }

    function showEditModal(title, currentValue, type) {
      console.log('showEditModal called:', title, currentValue, type);
      console.log('currentTeamIndex before showEditModal:', currentTeamIndex);

      // DON'T reassign - currentTeamIndex and editType are already set before calling this
      // Just use them as-is

      console.log('After setting - editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      const editModal = document.getElementById("editModal");
      const editInput = document.getElementById("editInput");

      document.getElementById("editModalTitle").textContent = title;
      editInput.value = currentValue;

      if (type === 'score' || type === 'scoreChange') {
        editInput.type = 'number';
        editInput.min = '0';
      } else {
        editInput.type = 'text';
      }

      editModal.classList.add("show");
      console.log('Edit modal visible, editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      setTimeout(() => {
        editInput.focus();
        editInput.select();
      }, 50);
    }

    function closeEditModal() {
      document.getElementById("editModal").classList.remove("show");
      currentTeamIndex = null;
      editType = null;
    }

    function saveEdit() {
      console.log('saveEdit called, editType:', editType, 'currentTeamIndex:', currentTeamIndex);
      const value = document.getElementById("editInput").value;
      console.log('Input value:', value);

      if (editType === 'name' && value.trim()) {
        console.log('Saving team name');
        teams[currentTeamIndex].name = value.trim();
        saveData();
        renderScoreboard();
        closeEditModal();
      } else if (editType === 'score') {
        const num = parseInt(value);
        console.log('Parsed score:', num);
        if (!isNaN(num) && num >= 0) {
          console.log('Saving team score');
          teams[currentTeamIndex].score = num;
          saveData();
          renderScoreboard();
          closeEditModal();
        }
      } else if (editType === 'scoreChange') {
        const amount = parseInt(value);
        console.log('Parsed score change amount:', amount);
        if (!isNaN(amount) && amount > 0) {
          const delta = changeScore.delta;
          console.log('Delta:', delta, 'applying change');
          if (delta > 0) {
            teams[currentTeamIndex].score += amount;
          } else {
            teams[currentTeamIndex].score = Math.max(0, teams[currentTeamIndex].score - amount);
          }
          saveData();
          renderScoreboard();
          closeEditModal();
        }
      } else {
        console.log('No valid save condition met');
      }
    }

    function verifyPin() {
      const input = document.getElementById("pinInput").value;

      // Check if already processing
      if (verifyPin.isProcessing) {
        console.log('Already processing, ignoring duplicate call');
        return;
      }

      console.log('Verifying PIN, editType:', editType, 'currentTeamIndex:', currentTeamIndex);

      if (input === PIN) {
        verifyPin.isProcessing = true;

        // Save editType and currentTeamIndex before closing modal
        const savedEditType = editType;
        const savedTeamIndex = currentTeamIndex;
        const savedAction = currentAction;

        console.log('Saved values - editType:', savedEditType, 'teamIndex:', savedTeamIndex, 'hasAction:', !!savedAction);

        closeModal();

        // Use setTimeout to ensure modal closes before opening edit modal
        setTimeout(() => {
          console.log('Inside setTimeout - editType:', savedEditType, 'teamIndex:', savedTeamIndex);
          if (savedAction) {
            console.log('Executing currentAction');
            savedAction();
          }
          else if (savedEditType === 'name') {
            console.log('Opening name edit modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            showEditModal(`Rediger ${teams[savedTeamIndex].name}`, teams[savedTeamIndex].name, savedEditType);
          } else if (savedEditType === 'score') {
            console.log('Opening score edit modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            showEditModal(`Rediger point for ${teams[savedTeamIndex].name}`, teams[savedTeamIndex].score, savedEditType);
          } else if (savedEditType === 'scoreChange') {
            console.log('Opening score change modal for team:', savedTeamIndex);
            // Set currentTeamIndex before calling showEditModal
            currentTeamIndex = savedTeamIndex;
            editType = savedEditType;
            const delta = changeScore.delta;
            const action = delta > 0 ? 'Tilf√∏j' : 'Fjern';
            showEditModal(`${action} point for ${teams[savedTeamIndex].name}`, Math.abs(delta), savedEditType);
          } else {
            console.log('No matching condition - savedEditType:', savedEditType, 'savedAction:', savedAction);
          }

          verifyPin.isProcessing = false;
        }, 150);
      } else {
        document.getElementById("errorMsg").textContent = "Forkert PIN - pr√∏v igen";
        document.getElementById("pinInput").value = "";
        document.getElementById("pinInput").focus();
      }
    }    // ===== TASK FUNCTIONS =====

    function renderTaskGrid() {
      const grid = document.getElementById("taskGrid");
      grid.innerHTML = "";

      tasks.forEach((task, idx) => {
        if (completedTasks.includes(idx)) return; // Skip completed tasks

        const card = document.createElement("div");
        card.className = "task-card";
        card.onclick = () => openTask(idx);

        card.innerHTML = `
          <div class="task-card-number">Opgave ${idx + 1}</div>
          <div class="task-card-title">${task.title}</div>
          <div class="task-card-description">${task.description}</div>
        `;

        grid.appendChild(card);
      });

      if (completedTasks.length === tasks.length) {
        grid.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: var(--muted);"><div style="font-size: 48px; margin-bottom: 16px;">üéâ</div><div style="font-size: 24px; font-weight: 600;">Alle opgaver gennemf√∏rt!</div><div style="margin-top: 12px;">Tryk "Nulstil Opgaver" for at starte forfra</div></div>';
      }
    }

    function openTask(index) {
      if (completedTasks.includes(index)) {
        alert("Denne opgave er allerede gennemf√∏rt!");
        return;
      }
      currentTaskIndex = index;
      document.getElementById("tasksOverview").classList.add("hidden");
      document.getElementById("taskDetail").classList.add("active");
      renderTask();
    }

    function showTasksOverview() {
      document.getElementById("taskDetail").classList.remove("active");
      document.getElementById("tasksOverview").classList.remove("hidden");
    }

    function completeTask(taskIndex) {
      if (!completedTasks.includes(taskIndex)) {
        completedTasks.push(taskIndex);
        saveData();
        renderTaskGrid();
        showTasksOverview();
      }
    }

    function completeTask(taskIndex) {
      if (!completedTasks.includes(taskIndex)) {
        completedTasks.push(taskIndex);
        saveData();
        renderTaskGrid();
        showTasksOverview();
      }
    }

    function renderTask() {
      const task = tasks[currentTaskIndex];
      document.getElementById("taskCounter").textContent = `Opgave ${currentTaskIndex + 1}/${tasks.length}`;
      document.getElementById("taskTitle").textContent = task.title;
      document.getElementById("taskDescription").textContent = task.description;

      const content = document.getElementById("taskContent");

      switch (task.type) {
        case "trivia":
          renderTriviaTask(content);
          break;
        case "emoji-songs":
          renderEmojiSongsTask(content);
          break;
        case "roulette":
          renderRouletteTask(content);
          break;
        case "most-likely":
          renderMostLikelyTask(content);
          break;
        case "truth-or-drink":
          renderTruthOrDrinkTask(content);
          break;
        default:
          content.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--muted);">
              <p style="font-size: 20px;">Denne opgave er endnu ikke tilg√¶ngelig</p>
            </div>
          `;
          document.getElementById("taskStatus").textContent = "Ikke tilg√¶ngelig";
      }
    }

    function nextTask() {
      if (currentTaskIndex < tasks.length - 1) {
        currentTaskIndex++;
        renderTask();
      }
    }

    function previousTask() {
      if (currentTaskIndex > 0) {
        currentTaskIndex--;
        renderTask();
      }
    }

    // ===== TASK RENDERS =====

    // 1. TRIVIA TASK
    function renderTriviaTask(container) {
      const questions = [
        { q: "Hvem i gruppen har drukket mest i √•r?", a: "" },
        { q: "Hvem har kysset flest piger?", a: "" },
        { q: "Hvem blev sidst inviteret til gruppen?", a: "" },
        { q: "Hvem har den st√∏rste sko-st√∏rrelse?", a: "" },
        { q: "Hvem snorker h√∏jest?", a: "" }
      ];

      let currentQ = 0;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Sp√∏rgsm√•l ${currentQ + 1}/${questions.length}
            </div>
            <div style="font-size: 24px; font-weight: 600; margin-bottom: 30px; line-height: 1.4;">
              ${questions[currentQ].q}
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
              ${currentQ > 0 ? '<button class="btn" onclick="triviaGoBack()">‚Üê Forrige</button>' : ''}
              ${currentQ < questions.length - 1 ? '<button class="btn primary" onclick="triviaNext()">N√¶ste ‚Üí</button>' : '<button class="btn primary" onclick="triviaFinish()">F√¶rdig! ‚úì</button>'}
            </div>
          </div>
        `;
      }

      window.triviaNext = () => { if (currentQ < questions.length - 1) { currentQ++; render(); } };
      window.triviaGoBack = () => { if (currentQ > 0) { currentQ--; render(); } };
      window.triviaFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üéâ</div><div style="font-size: 24px; font-weight: 600;">Godt klaret!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "I gang";
    }

    // 2. EMOJI SONGS TASK
    function renderEmojiSongsTask(container) {
      const songs = [
        { emoji: "üÉèüé∞üòê", answer: "pokerface", title: "Pokerface - Lady Gaga" },
        { emoji: "‚ö°üå©Ô∏èüí•", answer: "thunderstruck", title: "Thunderstruck - AC/DC" },
        { emoji: "üó∫Ô∏èüìçüß≠", answer: "maps", title: "Maps - Maroon 5" },
        { emoji: "üîüüìÖ‚è∞", answer: "10 √•r", title: "10 √•r - Emil Lange" },
        { emoji: "üí°üî¶‚ú®", answer: "skarpt lys", title: "Skarpt Lys - Gilli" },
        { emoji: "üèóÔ∏èüö®‚ö†Ô∏è", answer: "kranalarm", title: "Kranalarm - Jesubr√∏dre" },
        { emoji: "üç¨üé®üñåÔ∏è", answer: "candy paint", title: "Candy Paint - Post Malone" },
        { emoji: "üá©üá™üñ§‚ù§Ô∏èüíõ", answer: "deutschland", title: "Deutschland - Rammstein" },
        { emoji: "üíÉüëëüéµ", answer: "dancing queen", title: "Dancing Queen - ABBA" },
        { emoji: "üïäÔ∏è‚òÆÔ∏èü§ù", answer: "fred", title: "Fred - Bo Evers" }
      ];

      let currentS = 0;
      let revealed = false;
      let guessResult = null;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Sang ${currentS + 1}/${songs.length}
            </div>
            <div style="font-size: 64px; margin: 30px 0;">
              ${songs[currentS].emoji}
            </div>
            
            ${!revealed ? `
              <div style="max-width: 400px; margin: 20px auto;">
                <input 
                  type="text" 
                  id="songGuess" 
                  placeholder="Skriv dit g√¶t her..." 
                  style="width: 100%; padding: 16px; font-size: 18px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text); text-align: center;"
                  onkeypress="if(event.key==='Enter'){event.preventDefault();emojiCheckGuess();}"
                >
              </div>
              ${guessResult !== null ? `
                <div style="font-size: 20px; margin: 20px 0; padding: 16px; border-radius: 12px; background: ${guessResult ? 'rgba(36, 209, 143, 0.1)' : 'rgba(255, 92, 122, 0.1)'}; color: ${guessResult ? 'var(--ok)' : 'var(--bad)'};">
                  ${guessResult ? '‚úì Korrekt! üéâ' : '‚úó Forkert - pr√∏v igen'}
                </div>
              ` : ''}
            ` : `
              <div style="font-size: 20px; margin: 20px 0; min-height: 60px; color: var(--ok);">
                üéµ ${songs[currentS].title}
              </div>
            `}
            
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
              ${!revealed ? '<button class="btn" onclick="emojiCheckGuess()">Tjek svar</button>' : ''}
              ${currentS < songs.length - 1 ? '<button class="btn primary" onclick="emojiNext()">N√¶ste ‚Üí</button>' : '<button class="btn primary" onclick="emojiFinish()">F√¶rdig! ‚úì</button>'}
            </div>
          </div>
        `;
        if (!revealed) {
          setTimeout(() => document.getElementById("songGuess")?.focus(), 100);
        }
      }

      window.emojiCheckGuess = () => {
        const guess = document.getElementById("songGuess")?.value.toLowerCase().trim() || '';
        const answer = songs[currentS].answer.toLowerCase();
        const title = songs[currentS].title.toLowerCase();

        // Check if guess contains key words or matches title
        if (guess && (answer.includes(guess) || guess.includes(answer) || title.includes(guess) || guess.includes(title))) {
          guessResult = true;
          setTimeout(() => {
            revealed = true;
            guessResult = null;
            render();
          }, 1500);
        } else {
          guessResult = false;
          render();
        }
      };

      window.emojiReveal = () => { revealed = true; guessResult = null; render(); };
      window.emojiNext = () => { if (currentS < songs.length - 1) { currentS++; revealed = false; guessResult = null; render(); } };
      window.emojiFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üéµ</div><div style="font-size: 24px; font-weight: 600;">Alle sange gennemg√•et!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "I gang";
    }

    // 3. ROULETTE TASK
    function renderRouletteTask(container) {
      let spinning = false;
      let result = 0;

      function spin() {
        if (spinning) return;
        spinning = true;

        let spins = 0;
        const maxSpins = 20;

        const interval = setInterval(() => {
          result = Math.floor(Math.random() * 6) + 1;
          document.getElementById("rouletteNumber").textContent = result;
          spins++;

          if (spins >= maxSpins) {
            clearInterval(interval);
            spinning = false;
            document.getElementById("rouletteResult").innerHTML = `
              <div style="font-size: 20px; color: var(--accent); margin-top: 20px;">
                ${result === 1 ? 'üíÄ TAK 1 SHOT!' : result === 6 ? 'üéâ FORDEL 2 SHOTS!' : 'üòÖ Denne gang slap du!'}
              </div>
            `;
          }
        }, 100);
      }

      container.innerHTML = `
        <div style="text-align: center;">
          <div style="font-size: 120px; font-weight: 700; color: var(--accent); margin: 40px 0;" id="rouletteNumber">?</div>
          <button class="btn primary" onclick="spinRoulette()" style="font-size: 18px; padding: 16px 32px;">üé≤ Spin!</button>
          <div id="rouletteResult"></div>
          <div style="margin-top: 40px; font-size: 14px; color: var(--muted);">
            1 = Tag 1 shot | 6 = Fordel 2 shots | Andet = Ingenting
          </div>
          <div style="margin-top: 40px;">
            <button class="btn" onclick="rouletteFinish()">Afslut opgave ‚úì</button>
          </div>
        </div>
      `;

      window.spinRoulette = spin;
      window.rouletteFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üé≤</div><div style="font-size: 24px; font-weight: 600;">Roulette afsluttet!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };
      document.getElementById("taskStatus").textContent = "Klar til spin";
    }

    // 4. MOST LIKELY TASK
    function renderMostLikelyTask(container) {
      const questions = [
        "Hvem ville mest sandsynligt falde i s√∏vn f√∏rst til en fest?",
        "Hvem ville mest sandsynligt overleve en zombie-apokalypse?",
        "Hvem ville mest sandsynligt blive million√¶r?",
        "Hvem ville mest sandsynligt ende i f√¶ngsel?",
        "Hvem ville mest sandsynligt gifte sig f√∏rst?",
        "Hvem ville mest sandsynligt spise det v√¶mmeligste?",
        "Hvem ville mest sandsynligt blive ber√∏mt?",
        "Hvem ville mest sandsynligt glemme deres egen f√∏dselsdag?"
      ];

      let currentQ = 0;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Sp√∏rgsm√•l ${currentQ + 1}/${questions.length}
            </div>
            <div style="font-size: 24px; font-weight: 600; margin: 40px 20px; line-height: 1.5;">
              ${questions[currentQ]}
            </div>
            <div style="font-size: 16px; color: var(--muted); margin: 30px 0;">
              Point p√• personen n√•r I er klar!
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 40px;">
              ${currentQ < questions.length - 1 ? '<button class="btn primary" onclick="mostLikelyNext()">N√¶ste ‚Üí</button>' : '<button class="btn primary" onclick="mostLikelyFinish()">F√¶rdig! ‚úì</button>'}
            </div>
          </div>
        `;
      }

      window.mostLikelyNext = () => { if (currentQ < questions.length - 1) { currentQ++; render(); } };
      window.mostLikelyFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üëÜ</div><div style="font-size: 24px; font-weight: 600;">Alle sp√∏rgsm√•l gennemg√•et!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "I gang";
    }

    // 5. TRUTH OR DRINK TASK
    function renderTruthOrDrinkTask(container) {
      const questions = [
        "Hvad er det mest pinlige, du har gjort til en fest?",
        "Hvem i rummet ville du kysse, hvis du skulle?",
        "Hvad er din hemmelige guilty pleasure?",
        "Hvad er det vildeste sted, du har haft sex?",
        "Hvem var din f√∏rste k√¶reste, og hvorfor sluttede det?",
        "Hvad er den v√¶rste l√∏gn, du har fortalt dine for√¶ldre?",
        "Hvad er det mest ulovlige, du har gjort?",
        "Hvis du kun kunne se √©n person her igen, hvem ville det v√¶re?"
      ];

      let currentQ = 0;

      function render() {
        container.innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 18px; color: var(--muted); margin-bottom: 20px;">
              Sp√∏rgsm√•l ${currentQ + 1}/${questions.length}
            </div>
            <div style="font-size: 24px; font-weight: 600; margin: 40px 20px; line-height: 1.5;">
              ${questions[currentQ]}
            </div>
            <div style="font-size: 16px; color: var(--muted); margin: 30px 0;">
              Besvar √¶rligt eller tag en stor slurk! üç∫
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 40px;">
              ${currentQ < questions.length - 1 ? '<button class="btn primary" onclick="truthNext()">N√¶ste ‚Üí</button>' : '<button class="btn primary" onclick="truthFinish()">F√¶rdig! ‚úì</button>'}
            </div>
          </div>
        `;
      }

      window.truthNext = () => { if (currentQ < questions.length - 1) { currentQ++; render(); } };
      window.truthFinish = () => {
        container.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 32px; margin-bottom: 16px;">üçª</div><div style="font-size: 24px; font-weight: 600;">I overlevede!</div></div>';
        document.getElementById("taskStatus").textContent = "‚úÖ Gennemf√∏rt";
        completeTask(currentTaskIndex);
      };

      render();
      document.getElementById("taskStatus").textContent = "I gang";
    }

    // ===== EVENT LISTENERS =====

    document.getElementById("pinOkBtn").addEventListener("click", verifyPin);

    document.getElementById("pinInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        verifyPin();
      }
    });

    document.getElementById("editOkBtn").addEventListener("click", saveEdit);

    document.getElementById("editInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        saveEdit();
      }
    });

    // ===== INITIALIZE =====
    loadData();
    renderScoreboard();
    renderTaskGrid();
  </script>
</body>

</html>